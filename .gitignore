import java.io.*;
import java.util.Scanner;

class Main {
    static Scanner sc = new Scanner(System.in);
    public static void main(String[] args) {

        while(true){
            System.out.println("Welcome to Student Management System...");
            System.out.println("Enter the below option number...");
            System.out.println("1 -> Add student");
            System.out.println("2 -> View all student");
            System.out.println("3 -> delete a student with ID");
            System.out.println("4 -> Update a student with ID");
            System.out.println("5 -> Search student with ID");
            System.out.println("6 -> Exit");

            int option = sc.nextInt();

            switch (option) {
                case 1:
                    addStudent();
                    break;
                case 2:
                    viewStudent();
                    break;
                case 3:
                    deleteStudent();
                    break;
                case 4:
                    updateStudent();
                    break;
                case 5:
                    searchStudent();
                    break;
                case 6:
                    System.exit(0);
                default:
                    System.out.println("Invalid Choice try again...");
                    break;
            }
        }
    }

    public static void searchStudent() {
    System.out.println("Enter the student id to search :");
    String id=sc.next();
    try {
       BufferedReader bf=new BufferedReader(new FileReader("filehandling.txt") );
       String Line;
       int flag=0;
       while((Line=bf.readLine())!=null)
       {
        String [] str=Line.split(",");
        if(str[0].equals(id))
         {
             System.out.println("Student found");
             System.out.println("id:"+str[0]+"\n name:"+str[1]+"\n email:"+str[2]);
             flag=1;
         }
        } 
    } catch (Exception e) {
    }
    }

    public static void updateStudent() {
        System.out.println("Enter student ID to update:");
        String id = sc.next();
        try {
            BufferedReader bf = new BufferedReader(new FileReader("filehandling.txt"));
            BufferedWriter bw = new BufferedWriter(new FileWriter("tmp.txt"));
            String line;
            boolean found = false;
            while((line = bf.readLine()) != null) {
                String[] str = line.split(",");
                if(str[0].equals(id)) {
                    System.out.println("Enter new name:");
                    String name = sc.next();
                    System.out.println("Enter new email:");
                    String email = sc.next();
                    bw.write(id + "," + name + "," + email + "\n");
                    found = true;
                } else {
                    bw.write(line + "\n");
                }
            }
            bf.close();
            bw.close();
            if(found) {
                new File("filehandling.txt").delete();
                new File("tmp.txt").renameTo(new File("filehandling.txt"));
                System.out.println("Student deleted successfully!");
            } else {
                System.out.println("Student not found!");
            } 
        } catch (Exception e) {
        }
    }

    public static void deleteStudent() {
        System.out.println("Enter student ID to delete:");
        String id = sc.next();
        try {
            BufferedReader bf = new BufferedReader(new FileReader("filehandling.txt"));
            BufferedWriter bw = new BufferedWriter(new FileWriter("tmp.txt"));
            String line;
            boolean found = false;
            while((line = bf.readLine()) != null) {
                String[] str = line.split(",");
                if(!str[0].equals(id)) {
                    bw.write(line + "\n");
                } else {
                    found = true;
                }
            }
            bf.close();
            bw.close();
            if(found) {
                new File("filehandling.txt").delete();
                new File("tmp.txt").renameTo(new File("filehandling.txt"));
                System.out.println("Student deleted successfully!");
            } else {
                System.out.println("Student not found!");
            } 
        } catch(Exception e) {
        }
    }

    public static void viewStudent() {
        try (BufferedReader bf = new BufferedReader(new FileReader("filehandling.txt"))) {
            String line;
            while ((line = bf.readLine()) != null) {
                String[] str = line.split(",");
                System.out.println("ID: " + str[0] + ", Name: " + str[1] + ", Email: " + str[2]);
            }
        } catch (Exception e) {
        }
    }

    public static void addStudent() {
 try (FileWriter fw=new FileWriter("filehandling.txt", true) ){
    System.out.println("Enter student id:");
    String id = sc.next();
    System.out.println("Enter student name:");
    String name = sc.next();
    System.out.println("Enter student email:");
    String email = sc.next();
    fw.write(id + "," + name + "," + email + "\n");
    System.out.println("Student added successfully!");
 } catch (Exception e) {
 }       
    }
}
